<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Seguimiento Automechanika v2.0 - Lizarte</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            color: #2d3748;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            margin: 0 auto 12px;
            background: linear-gradient(135deg, #c026d3 0%, #9333ea 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 25px;
        }
        
        h1 {
            font-size: 20px;
            color: #2d3748;
            margin-bottom: 5px;
        }
        
        .subtitle {
            color: #718096;
            font-size: 13px;
        }
        
        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            margin-top: 8px;
            font-weight: 600;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            font-size: 10px;
            color: #718096;
            margin-top: 5px;
            text-transform: uppercase;
        }
        
        .tabs {
            background: white;
            border-radius: 12px;
            padding: 5px;
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .tab {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .filters {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }
        
        .filter-item label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 5px;
        }
        
        .filter-item input,
        .filter-item select {
            width: 100%;
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 13px;
        }
        
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        .items-container {
            display: grid;
            gap: 15px;
        }
        
        .item-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .item-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            color: white;
        }
        
        .item-company {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .item-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            font-size: 12px;
            opacity: 0.95;
        }
        
        .item-body {
            padding: 15px;
        }
        
        .fotos-section {
            margin-bottom: 15px;
        }
        
        .fotos-section-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #2d3748;
        }
        
        .fotos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .foto-item {
            position: relative;
        }
        
        .foto-thumb {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .foto-delete {
            position: absolute;
            top: 4px;
            right: 4px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .add-foto-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 8px;
        }
        
        .seguimiento-box {
            background: #f7fafc;
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
        }
        
        .seguimiento-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #2d3748;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 5px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 13px;
            font-family: inherit;
        }
        
        .form-group textarea {
            min-height: 50px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px;
            align-items: end;
        }
        
        .btn-notify {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .estado-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .estado-option {
            position: relative;
        }
        
        .estado-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        
        .estado-option label {
            display: block;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
            font-weight: 600;
        }
        
        .estado-option input:checked + label {
            border-color: #667eea;
            background: #f0f4ff;
            color: #667eea;
        }
        
        .estado-pendiente label { color: #6b7280; }
        .estado-contactado label { color: #f59e0b; }
        .estado-proceso label { color: #3b82f6; }
        .estado-finalizado label { color: #10b981; }
        
        .estado-pendiente input:checked + label { border-color: #6b7280; background: #f3f4f6; color: #6b7280; }
        .estado-contactado input:checked + label { border-color: #f59e0b; background: #fffbeb; color: #f59e0b; }
        .estado-proceso input:checked + label { border-color: #3b82f6; background: #eff6ff; color: #3b82f6; }
        .estado-finalizado input:checked + label { border-color: #10b981; background: #f0fdf4; color: #10b981; }
        
        .acciones-list {
            margin-bottom: 12px;
        }
        
        .accion-item {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 8px;
            margin-bottom: 8px;
            align-items: start;
        }
        
        .accion-item textarea {
            min-height: 40px;
        }
        
        .btn-delete-accion {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
        }
        
        .btn-add-accion {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            width: 100%;
        }
        
        .priority-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .priority-critica {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .priority-alta {
            background: #fef3c7;
            color: #92400e;
        }
        
        .priority-media {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .priority-baja {
            background: #e5e7eb;
            color: #374151;
        }
        
        .depto-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .depto-innovacion {
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(236, 72, 153, 0.3);
        }
        
        .depto-lizarte {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        
        .config-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
        }
        
        .config-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #2d3748;
        }
        
        .config-group {
            margin-bottom: 20px;
        }
        
        .config-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 8px;
        }
        
        .config-group input,
        .config-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }
        
        .config-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .btn-save-config {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }
        
        .btn-export {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        /* Bot√≥n flotante de exportaci√≥n */
        .btn-float-export {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-float-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(16, 185, 129, 0.6);
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }
        
        .btn-float-export:active {
            transform: translateY(0);
        }
        
        .modal-content {
            max-width: 90%;
            max-height: 90%;
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 35px;
            cursor: pointer;
            background: rgba(0,0,0,0.5);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 900;
        }
        
        .save-indicator.show {
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .fotos-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .estado-selector {
                grid-template-columns: 1fr;
            }
        }
        
        /* ========== SPLASH SCREEN STYLES ========== */
        
        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 50%, #16213e 100%);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            animation: splashFadeIn 0.5s ease-out;
        }
        
        #splashScreen.fade-out {
            animation: splashFadeOut 1s ease-out forwards;
        }
        
        .splash-bg-map {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120%;
            height: 120%;
            opacity: 0.15;
            filter: blur(1px);
        }
        
        .splash-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: white;
            border-radius: 50%;
            animation: particleFloat 8s infinite;
            opacity: 0;
        }
        
        .splash-content {
            position: relative;
            z-index: 2;
            text-align: center;
            color: white;
            max-width: 800px;
            padding: 40px;
        }
        
        .splash-route {
            margin-bottom: 60px;
            opacity: 0;
            animation: fadeInUp 1s ease-out 0.5s forwards;
        }
        
        .route-point {
            font-size: 18px;
            font-weight: 600;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .route-line {
            width: 2px;
            height: 60px;
            background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
            margin: 10px auto;
            position: relative;
            overflow: hidden;
        }
        
        .route-line::after {
            content: '';
            position: absolute;
            top: -100%;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent, white, transparent);
            animation: routeFlow 2s ease-out 0.8s forwards;
        }
        
        .plane-icon {
            font-size: 32px;
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%) rotate(180deg);
            animation: planeMove 2s ease-out 0.8s forwards;
        }
        
        .splash-stats {
            margin: 50px 0;
            opacity: 0;
            animation: fadeInScale 0.8s ease-out 3s forwards;
        }
        
        .stat-item {
            margin: 25px 0;
            padding: 20px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 15px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            transition: all 0.3s;
        }
        
        .stat-item:hover {
            border-color: rgba(59, 130, 246, 0.6);
            transform: scale(1.02);
        }
        
        .stat-number {
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: inline-block;
            text-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
            margin-right: 15px;
        }
        
        .stat-number.glow {
            animation: numberGlow 0.5s ease-out;
        }
        
        .stat-label {
            font-size: 16px;
            color: #cbd5e1;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .splash-message {
            margin: 50px 0;
            opacity: 0;
            animation: fadeInUp 1s ease-out 6s forwards;
        }
        
        .splash-title {
            font-size: 42px;
            font-weight: 800;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #60a5fa, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 40px rgba(96, 165, 250, 0.3);
        }
        
        .splash-subtitle {
            font-size: 24px;
            color: #cbd5e1;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .splash-date {
            font-size: 18px;
            color: #94a3b8;
            margin-bottom: 30px;
        }
        
        .splash-divider {
            width: 300px;
            height: 2px;
            background: linear-gradient(to right, transparent, #3b82f6, transparent);
            margin: 20px auto;
        }
        
        .splash-credit {
            font-size: 14px;
            color: #64748b;
            margin-top: 20px;
        }
        
        .splash-button {
            opacity: 0;
            animation: fadeInScale 0.8s ease-out 9s forwards;
        }
        
        .btn-access {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 18px;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 40px rgba(59, 130, 246, 0.4);
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-access::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-access:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn-access:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 60px rgba(59, 130, 246, 0.6);
        }
        
        .btn-access:active {
            transform: scale(0.98);
        }
        
        .splash-close {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            z-index: 10;
        }
        
        .splash-close:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: rotate(90deg);
        }
        
        /* ========== ANIMATIONS ========== */
        
        @keyframes splashFadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes splashFadeOut {
            to {
                opacity: 0;
                visibility: hidden;
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes routeFlow {
            to {
                top: 100%;
            }
        }
        
        @keyframes planeMove {
            to {
                top: 100%;
            }
        }
        
        @keyframes particleFloat {
            0% {
                opacity: 0;
                transform: translateY(100vh) translateX(0);
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) translateX(50px);
            }
        }
        
        @keyframes numberGlow {
            0%, 100% {
                text-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
            }
            50% {
                text-shadow: 0 0 60px rgba(59, 130, 246, 1), 0 0 90px rgba(139, 92, 246, 0.8);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }
    </style>
</head>
<body>
    <!-- ========== SPLASH SCREEN ========== -->
    <div id="splashScreen" style="display: none;">
        <!-- Bot√≥n cerrar -->
        <div class="splash-close" onclick="closeSplash()">‚úï</div>
        
        <!-- Mapa de fondo -->
        <div class="splash-bg-map">
            <svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
                <!-- Mapa simplificado de China con l√≠neas -->
                <path d="M 400 100 L 600 150 L 650 300 L 600 450 L 400 500 L 200 450 L 150 300 L 200 150 Z" 
                      fill="none" 
                      stroke="url(#mapGradient)" 
                      stroke-width="2" 
                      opacity="0.6"/>
                <!-- Cuadr√≠cula -->
                <line x1="0" y1="150" x2="800" y2="150" stroke="rgba(59, 130, 246, 0.2)" stroke-width="1"/>
                <line x1="0" y1="300" x2="800" y2="300" stroke="rgba(59, 130, 246, 0.2)" stroke-width="1"/>
                <line x1="0" y1="450" x2="800" y2="450" stroke="rgba(59, 130, 246, 0.2)" stroke-width="1"/>
                <line x1="200" y1="0" x2="200" y2="600" stroke="rgba(59, 130, 246, 0.2)" stroke-width="1"/>
                <line x1="400" y1="0" x2="400" y2="600" stroke="rgba(59, 130, 246, 0.2)" stroke-width="1"/>
                <line x1="600" y1="0" x2="600" y2="600" stroke="rgba(59, 130, 246, 0.2)" stroke-width="1"/>
                <!-- Definiciones de gradientes -->
                <defs>
                    <linearGradient id="mapGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#8b5cf6;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
                    </linearGradient>
                </defs>
            </svg>
        </div>
        
        <!-- Part√≠culas -->
        <div class="splash-particles" id="particlesContainer"></div>
        
        <!-- Contenido principal -->
        <div class="splash-content">
            <!-- FASE 1: Ruta animada (0-3 seg) -->
            <div class="splash-route" id="splashRoute">
                <div class="route-point">üìç PAMPLONA, ESPA√ëA</div>
                <div class="route-line" style="position: relative;">
                    <div class="plane-icon">‚úàÔ∏è</div>
                </div>
                <div class="route-point">üìç SHANGHAI, CHINA</div>
            </div>
            
            <!-- FASE 2: Estad√≠sticas (3-6 seg) -->
            <div class="splash-stats" id="splashStats">
                <div class="stat-item">
                    <span class="stat-number" id="stat1">0</span>
                    <span class="stat-label">üè¢ Empresas Contactadas</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="stat2">0</span>
                    <span class="stat-label">ü§ù Reuniones Estrat√©gicas</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="stat3">0</span>
                    <span class="stat-label">üì∑ Registros Visuales</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="stat4">0</span>
                    <span class="stat-label">üíº Oportunidades Cr√≠ticas</span>
                </div>
            </div>
            
            <!-- FASE 3: Mensaje (6-9 seg) -->
            <div class="splash-message" id="splashMessage">
                <div class="splash-title">MISI√ìN COMPLETADA</div>
                <div class="splash-title" style="font-size: 36px; margin-top: 10px;">KRUM KOVACHEV</div>
                <div class="splash-subtitle">AUTOMECHANIKA SHANGHAI 2025</div>
                <div class="splash-date">19 Nov - 6 Dic</div>
                <div class="splash-divider"></div>
                <div class="splash-credit">Lizarte ‚Ä¢ Sistema de Gesti√≥n</div>
            </div>
            
            <!-- FASE 4: Bot√≥n (9-12 seg) -->
            <div class="splash-button">
                <button class="btn-access" onclick="closeSplash()">
                    <span style="position: relative; z-index: 1;">üöÄ ACCEDER AL SISTEMA</span>
                </button>
                <div class="splash-credit" style="margin-top: 20px;">V12 by Krum Kovachev</div>
            </div>
        </div>
    </div>
    
    <!-- Bot√≥n flotante de exportaci√≥n -->
    <button class="btn-float-export" onclick="exportarDatosActualizados(event)" title="Exportar todos los datos actualizados">
        üì§ EXPORTAR
    </button>
    
    <div class="header">
        <div class="logo">üöó</div>
        <h1>Seguimiento Automechanika Shanghai 2025</h1>
        <div class="subtitle">Lizarte - Sistema de Gesti√≥n de Contactos</div>
        <div class="version-badge">V12 by Krum Kovachev</div>
    </div>
    
    <div class="stats">
        <div class="stat-card">
            <div class="stat-value" id="statTotal">0</div>
            <div class="stat-label">Total</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="statPendientes">0</div>
            <div class="stat-label">Pendientes</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="statContactados">0</div>
            <div class="stat-label">Contactados</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="statProceso">0</div>
            <div class="stat-label">En Proceso</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="statFinalizados">0</div>
            <div class="stat-label">Finalizados</div>
        </div>
    </div>
    
    <div class="tabs">
        <button class="tab active" onclick="switchTab('reuniones')">ü§ù Reuniones (25)</button>
        <button class="tab" onclick="switchTab('adicional')">üìã Info Adicional (11)</button>
        <button class="tab" onclick="switchTab('config')">‚öôÔ∏è Configuraci√≥n</button>
    </div>
    
    <div class="filters">
        <div class="filter-grid">
            <div class="filter-item">
                <label>üîç Buscar</label>
                <input type="text" id="searchInput" placeholder="Empresa..." oninput="applyFilters()">
            </div>
            <div class="filter-item">
                <label>üè¢ Departamento</label>
                <select id="filterDepartamento" onchange="applyFilters()">
                    <option value="">Todos</option>
                    <option value="Lizarte">üîµ Lizarte</option>
                    <option value="Innovaci√≥n">‚≠ê Innovaci√≥n</option>
                </select>
            </div>
            <div class="filter-item">
                <label>üë§ Responsable</label>
                <select id="filterResponsable" onchange="applyFilters()">
                    <option value="">Todos</option>
                </select>
            </div>
            <div class="filter-item">
                <label>üìä Estado</label>
                <select id="filterEstado" onchange="applyFilters()">
                    <option value="">Todos</option>
                    <option value="pendiente">Pendiente</option>
                    <option value="contactado">Contactado</option>
                    <option value="proceso">En Proceso</option>
                    <option value="finalizado">Finalizado</option>
                </select>
            </div>
        </div>
    </div>
    
    <div id="reunionesSection" class="content-section active">
        <div id="reunionesContainer" class="items-container"></div>
    </div>
    
    <div id="adicionalSection" class="content-section">
        <div id="adicionalContainer" class="items-container"></div>
    </div>
    
    <div id="configSection" class="content-section">
        <div class="config-section">
            <div class="config-title">‚öôÔ∏è Configuraci√≥n General</div>
            
            <div class="config-group">
                <label>T√≠tulo Principal</label>
                <input type="text" id="configTitulo" value="Seguimiento Automechanika Shanghai 2025">
            </div>
            
            <div class="config-group">
                <label>Subt√≠tulo</label>
                <input type="text" id="configSubtitulo" value="Lizarte - Sistema de Gesti√≥n de Contactos">
            </div>
            
            <div class="config-group">
                <label>Miembros del Equipo (separados por comas)</label>
                <textarea id="configEquipo">Krum Kovachev, Equipo T√©cnico, Equipo Comercial, Direcci√≥n, Sin asignar</textarea>
            </div>
            
            <div class="config-group">
                <label>Notas Generales del Proyecto</label>
                <textarea id="configNotas" placeholder="A√±ade notas generales sobre la feria, objetivos, conclusiones..."></textarea>
            </div>
            
            <button class="btn-save-config" onclick="saveConfig()">üíæ Guardar Configuraci√≥n</button>
        </div>
    </div>
    
    <button class="btn-export" onclick="exportarInforme()">
        üìä Exportar Informe Completo
    </button>
    
    <div id="photoModal" class="modal" onclick="closeModal()">
        <span class="modal-close">&times;</span>
        <img id="modalImage" class="modal-content">
    </div>
    
    <div id="saveIndicator" class="save-indicator">‚úì Guardado</div>
    
    <input type="file" id="fileInput" accept="image/*" multiple style="display: none;" onchange="handleFileUpload(event)">
    
    <script>
        let appData = null;
        let equipoLizarte = [];
        let currentUploadTarget = null;
        let appConfig = {
            titulo: 'Seguimiento Automechanika Shanghai 2025',
            subtitulo: 'Lizarte - Sistema de Gesti√≥n de Contactos',
            equipo: 'Krum Kovachev, Equipo T√©cnico, Equipo Comercial, Direcci√≥n, Sin asignar',
            notas: ''
        };
        
        async function loadData() {
            console.log('üöÄ === CARGANDO DATOS ===');
            
            try {
                // Intentar cargar datos.json actualizado primero
                console.log('üì• Intentando cargar datos.json...');
                const response = await fetch('datos.json?t=' + Date.now());
                
                if (response.ok) {
                    appData = await response.json();
                    console.log('‚úÖ datos.json cargado (ACTUALIZADO):');
                    console.log('   - Reuniones:', appData.reuniones.length);
                    console.log('   - Adicional:', appData.adicional.length);
                } else {
                    throw new Error('datos.json no encontrado');
                }
            } catch (error) {
                // Si falla, usar datos embebidos como respaldo
                console.log('‚ö†Ô∏è No se pudo cargar datos.json, usando datos embebidos');
                console.log('   Error:', error.message);
                
                // Los datos embebidos ya est√°n en appData desde la l√≠nea anterior
                if (!appData) {
                    console.error('‚ùå ERROR: No hay datos embebidos de respaldo');
                    alert('ERROR: No se pudieron cargar los datos');
                    return;
                }
                
                console.log('‚úÖ Usando datos embebidos:');
                console.log('   - Reuniones:', appData.reuniones.length);
                console.log('   - Adicional:', appData.adicional.length);
            }
            
            // Inicializar campos si no existen en el JSON
            appData.reuniones.forEach(item => {
                if (!item.seguimiento) {
                    item.seguimiento = {
                        responsable: '',
                        email: '',
                        estado: 'pendiente',
                        acciones: [],
                        fecha_contacto: '',
                        notas: ''
                    };
                }
                if (!item.seguimiento.acciones) item.seguimiento.acciones = [];
                if (!item.seguimiento.estado) item.seguimiento.estado = 'pendiente';
                if (!item.fotos_extra) item.fotos_extra = [];
                if (!item.documentos) item.documentos = [];
            });
            
            appData.adicional.forEach(item => {
                if (!item.seguimiento) {
                    item.seguimiento = {
                        responsable: '',
                        email: '',
                        estado: 'pendiente',
                        acciones: [],
                        fecha_contacto: '',
                        notas: ''
                    };
                }
                if (!item.seguimiento.acciones) item.seguimiento.acciones = [];
                if (!item.seguimiento.estado) item.seguimiento.estado = 'pendiente';
                if (!item.fotos_extra) item.fotos_extra = [];
                if (!item.documentos) item.documentos = [];
            });
            
            loadConfig();
            // NO llamamos a loadSeguimiento() ni loadDocumentos() porque el JSON ya tiene todo
            populateResponsableFilter();
            renderAll();
            updateStats();
        }
        
        function convertAirtableToAppData(records) {
            const DATOS_EMBEBIDOS = {"reuniones":[{"company":"MACHAGE","person":"Tommy","product":"Varios","time":"16:10","stand":"Hall 4.1 H79","comments":"","id":1763363438764,"fotos":["fotos/reunion_machage_foto1.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"ALTEZZA","person":"Gustavo/Gloria","product":"Varios","time":"14:45","stand":"Hall 2.1 A71","comments":"La pr√≥xima semana nos van a mandar cinco grupos hidr√°ulicos para testear.
Si le damos el OK antes de Navidad, nos las mandar√°n r√°pido si no ya ser√≠a despu√©s del A√±o Nuevo y en marzo empezar empezar√≠an a fabricarlas y tardar√≠an un mes en hacer la fabricaci√≥n m√°s el plazo de env√≠o. Habl√≥ con Gloria de las cremalleras de husillo Paradise. Le he dicho que las √∫ltimas ofertas que hemos tenido han sido por un valor de 100 ‚Ç¨ la unidad aunque en realidad son m√°s altas las que nos han ofrecido y que a m√≠ un precio interesante ser√≠a unos 50 ‚Ç¨ la unidad y me dice que no le parece imposible de conseguir ha recomendable que Javier Bazt√°n y yo hablemos con ella de pedirle varias referencias y que nos las coticen. me ofrece EPS nuevas y le pregunto que referencia; Honda CV-R, no son interesantes. Me ense√±a otro documento en el que venden conectores y recambios para DAES.","id":1763364468847,"fotos":[],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"CHABGHUI GROUP","person":"Jason Bai","product":"Varios","time":"16:18","stand":"Hall 6.1 F01","comments":"Tienen la DAE nueva (Ford pickup). Tambi√©n te llenen distintos componentes como pueden ser. si vienen √°ngulos de sensor, tambi√©n tienen cosas de salpicadero clock Spring Fusion switch entre otras referencias y dicen que las.","id":1763378341743,"fotos":["fotos/reunion_chabghui_group_foto1.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"LT Drive Shaft","person":"Cactus?","product":"Drive Shaft","time":"18:12","stand":"Hall 1.1 C24","comments":"","id":1763719943011,"fotos":[],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"Bomba Mini","person":"Sharly","product":"Bomba Mini","time":"08:12","stand":"Hall1.1 A10","comments":"","id":1763896381600,"fotos":[],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"CIPE Breaking Systems Technology","person":"Fiona Lu","product":"EPB","time":"11:29","stand":"Hall 6.1 E02","comments":"","id":1763954957878,"fotos":[],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"Taizhou EBS Autoparts","person":"Stefen Dong","product":"EBS y pinzas de freno","time":"11:34","stand":"Hall 3 E56","comments":"","id":1763955286688,"fotos":[],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"UKAT???","person":"Molly","product":"No especifica en el email","time":"12:13","stand":"Hall 7.1 E76","comments":"","id":1763957620217,"fotos":[],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"EBI Bearing","person":"John Zhao","product":"Rodamientos","time":"12:15","stand":"Hall 1.1 D33","comments":"","id":1763957712020,"fotos":[],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"AIERFU","person":"Dane","product":"Direcciones","time":"19:32","stand":"Hall 6.1 F55","comments":"Nueva l√≠nea de fabricaci√≥n, han mandado ya dos cremalleras de DAEs.","id":1763983993823,"fotos":["fotos/reunion_aierfu_foto1.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"YLCNC","person":"Kairi Ban","product":"Conectores","time":"10:00","stand":"Hall 4.1 C56","comments":"Conectores de todo tipo.","id":1764122436398,"fotos":["fotos/reunion_ylcnc_foto2.jpg","fotos/reunion_ylcnc_foto1.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"- Cangzhou Fubang","person":"-Lucy","product":"Conectores autom√≥vil","time":"10:17","stand":"Hall 4.1 H119","comments":"","id":1764123486251,"fotos":["fotos/reunion___cangzhou_fubang_foto2.jpg","fotos/reunion___cangzhou_fubang_foto1.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"YANGYU","person":"P","product":"EGR Valve","time":"10:31","stand":"Hall 4.1 E43","comments":"Tienen muchas referencias, nos conocen pero no han contactado con nosotros. Dice que nos conocen como marca reconocida en Europea.","id":1764124295568,"fotos":["fotos/reunion_yangyu_foto1.jpg","fotos/reunion_yangyu_foto2.jpg","fotos/reunion_yangyu_foto3.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"Matteo Vehicle Parts Factory","person":"Marco (General Manager)","product":"Relen","time":"10:44","stand":"Hall 4.1 B61","comments":"Tiene mas reles que la empresa anterior.","id":1764125076721,"fotos":["fotos/reunion_matteo_vehicle_parts_factory_foto1.jpg","fotos/reunion_matteo_vehicle_parts_factory_foto2.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"KITPAMT","person":"Anna","product":"DAES Y COMPONENTES","time":"11:31","stand":"Hall 5.1 D111","comments":"Venden completas, componentes como rodamientos de aguja, rodamientos normales, grandes, carcasas, tapas de conectores, correas y los cables. Tienen posicionadores tambi√©n pero son diferentes.Hostas tienen sensor pi√±√≥n para Golf 5. Mirar fotos m√≥vil","id":1764127927936,"fotos":["fotos/reunion_kitpamt_foto1.jpg","fotos/reunion_kitpamt_foto3.jpg","fotos/reunion_kitpamt_foto2.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"QUANBANG","person":"Con Liu","product":"Direcciones","time":"12:00","stand":"Hall 5.1 F99","comments":"Venden Direcciones hidr√°ulicas, pero lo que destaco es que venden terminales, me va a mandar el cat√°logo para compartir con Javier Bazt√°n y pedir precio.","id":1764129667486,"fotos":["fotos/reunion_quanbang_foto1.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"YUGFROST","person":"David Gontmakher( Manager)","product":"Aires acondicionados para camiones","time":"12:08","stand":"Hall 5.1 K64","comments":"Son dos compa√±√≠as en uno o Rusia y China hacen aires acondicionados para camiones es decir cuando el camionero ha parado a descansar puede tener el aire acondicionado encendido cuando la bater√≠a est√° al menos del 30 %. Se apaga.
Podr√≠an personalizar los productos con nuestra caja y con nuestro nombre para que se venda bajo la marca Lizarte","id":1764130099961,"fotos":["fotos/reunion_yugfrost_foto2.jpg","fotos/reunion_yugfrost_foto1.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"FOBAUTOPARTS","person":"Jared Cheb","product":"Direcciones","time":"12:42","stand":"Hall 6.1 F100","comments":"Dicen que las bombas las compran a Quanxing, pero que las Direcciones las fabrican ellos. Tambi√©n ofrecen transmisiones. Dice que ellos agrupan los pedidos y hacen la revisi√≥n antes de que salga el producto y nos pueden mandar fotos del producto es decir, ser√≠a una compa√±√≠a que agrupan el material y y revisa que est√© todo en orden. Me comenta que las transmisiones las compras a GSP pero que GSP no puede poner nuestra marca y ellos si. Har√≠an la inspecci√≥n por nosotros antes de enviar el producto. Pueden conseguir agrupar material y tambi√©n dice que pueden hacer la revisi√≥n antes de que el material haya sido enviado. Me parece interesante plantear como una empresa que no se revise el material antes de ser enviado. nos pueden dar referencias de otras empresas o incluso llevar a visitarlas para verlas.","id":1764132222182,"fotos":["fotos/reunion_fobautoparts_foto1.jpg","fotos/reunion_fobautoparts_foto3.jpg","fotos/reunion_fobautoparts_foto2.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"CHANGHI","person":"Jason Bai","product":"DAES","time":"13:39","stand":"Hall 6.1 F01","comments":"","id":1764135592052,"fotos":[],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"WINNER AUTOPARTS","person":"No se","product":"EGR","time":"14:19","stand":"Hall 2.1 A96","comments":"Te llenan v√°lvulas EGR dep√≥sitos de AdBlue. Pido cat√°logo en Excel.","id":1764137943163,"fotos":["fotos/reunion_winner_autoparts_foto3.jpg","fotos/reunion_winner_autoparts_foto1.jpg","fotos/reunion_winner_autoparts_foto2.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"SEINECA","person":"Luis Yu","product":"CV JOINT","time":"16:24","stand":"Hall 3 K60","comments":"Es una empresa que se fund√≥ en el 2010 y ellos fabrican. E-mail. nos van a pasar sus referencias FAA mover de Europa con el OEM c√≥digo y luego otra persona que est√° aqu√≠ sentada en la mesa me va a mandar un cat√°logo con sensores para columnas y DAES!","id":1764145484162,"fotos":["fotos/reunion_seineca_foto1.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"CHIBOSS","person":"Levi","product":"Correas EPS","time":"09:45","stand":"Hall 3.1 H123","comments":"Venden todo tipo de correas como las que necesitamos y tambi√©n hay unas que son m√°s finas.
Hancy@chiboss.cn que nos va a mandar el PDF el Stand ten√≠a muy buena pinta","id":1764207955485,"fotos":["fotos/reunion_chiboss_foto2.jpg","fotos/reunion_chiboss_foto1.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"ZFYLCD","person":"Karol y lilei","product":"Cardans","time":"10:07","stand":"Hall 1.1 E01","comments":"Venden Car dans y te llene buena pinta al menos el estante, el producto que se ve l√≥gicamente habr√°n llevado el mejor producto posible pero es interesante hablar con ellos me van a mandar el cat√°logo y comentan que trabajan con con veh√≠culos del parque europeo","id":1764209275780,"fotos":["fotos/reunion_zfylcd_foto2.jpg","fotos/reunion_zfylcd_foto1.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"WUXI BELT","person":"Hanna","product":"Correas para DAES","time":"10:14","stand":"Hall 1.1","comments":"","id":1764209654681,"fotos":["fotos/reunion_wuxi_belt_foto1.jpg","fotos/reunion_wuxi_belt_foto2.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"company":"TENDA TEC","person":"Jim Lee","product":"EGR","time":"10:26","stand":"Hall 1.1","comments":"","id":1764210396599,"fotos":["fotos/reunion_tenda_tec_foto2.jpg","fotos/reunion_tenda_tec_foto1.jpg"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"}],"adicional":[{"id":"add_1","empresa":"N.F.YO","producto":"Ruedas y neum√°ticos","notas":"Exclusiva de venta de neum√°ticos en Espa√±a. Ruedas de coches, motos, tractores. En Espa√±a las ruedas de tractores son extremadamente caras.","oportunidad":"Nuevo negocio - venta de ruedas en Europa","prioridad":"alta","seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Innovaci√≥n"},{"id":"add_2","empresa":"Inyectores Diesel","producto":"Cabezas de inyectores Diesel","notas":"Va a mandar el cat√°logo. Producto de nicho muy interesante ya que en Espa√±a el precio es alto.","oportunidad":"Producto de nicho con buen margen","prioridad":"media","seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"id":"add_3","empresa":"M√°quinas equilibrado","producto":"M√°quinas de equilibrado y cambio de ruedas","notas":"Varias empresas vistas con este producto","oportunidad":"Nuevo posible negocio - venta de m√°quinas","prioridad":"media","seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"id":"add_4","empresa":"Componentes el√©ctricos","producto":"Conectores, cables y componentes el√©ctricos","notas":"Conectores como los de Autel. Tambi√©n puntas y herramientas.","oportunidad":"ESCRIBIRLE AL CHINO con fotos de componentes que necesitamos. Poner a Pablo en copia.","prioridad":"alta","seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"Email con fotos componentes el√©ctricos necesarios","fechaSeguimiento":""},"departamento":"Lizarte"},{"id":"add_5","empresa":"Tornillos VW","producto":"Tornillos calidad 10.9/12.9 y Stier One","notas":"F√°brica de tornillos espec√≠ficos para Volkswagen. Alta calidad.","oportunidad":"Calidad premium espec√≠fica VW","prioridad":"media","seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"id":"add_6","empresa":"Herramientas Premium","producto":"Puntas, herramientas, pistolas","notas":"MEJOR STAND DE HERRAMIENTAS visto hasta ahora","oportunidad":"Proveedor premium de herramientas","prioridad":"alta","seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"id":"add_7","empresa":"Direct Sillones - Silvia G","producto":"Direcciones","notas":"Mujer que habla perfectamente castellano - gran ventaja para comunicarnos","oportunidad":"Comunicaci√≥n fluida en espa√±ol","prioridad":"alta","seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"id":"add_8","empresa":"Correas / EPS","producto":"Correas y EPS nuevas","notas":"Empresas dedicadas a fabricaci√≥n de correas. Pueden desarrollar nuevas. Tienen EPS nuevas pero para mercado USA.","oportunidad":"Desarrollo de producto y expansi√≥n EPS","prioridad":"media","seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"id":"add_9","empresa":"YAS - Bruce Lee","producto":"Direcciones (PROYECTO CLAVE)","notas":"REUNI√ìN IMPORTANTE: No est√°n interesados en proyecto inicial de almac√©n. PROPONEN: Mandarnos mucho material y ampliar plazo de pago. Lizarte se encarga de vender. Referencias homologadas + no homologadas para mercado europeo. Vender√≠amos con marca LIZARTE.","oportunidad":"PROYECTO ESTRAT√âGICO - Ampliar cat√°logo direcciones significativamente","prioridad":"cr√≠tica","seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"Informar volumen anual de direcciones vendidas para calcular plazo de pago","fechaSeguimiento":""},"departamento":"Innovaci√≥n"},{"id":"add_10","empresa":"Varios - Otros productos","producto":"Altavoces, ventiladores, rodamientos, guantes","notas":"Altavoces para coches. Ventiladores peque√±os con potencia. Rodamientos varios. Guantes naranja con bolitas.","oportunidad":"Diversificaci√≥n cat√°logo","prioridad":"baja","seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":""},"departamento":"Lizarte"},{"id":"add_11","empresa":"Galer√≠a OneNote - Tarjetas y Fotos","producto":"Tarjetas de visita, productos, stands","notas":"47 fotos extra√≠das del documento OneNote. Incluye tarjetas de visita de contactos, fotos de productos, stands visitados y material de referencia.","oportunidad":"Archivo visual de referencia de la feria","prioridad":"media","fotos":["fotos/onenote_imagen-000.png","fotos/onenote_imagen-001.png","fotos/onenote_imagen-002.png","fotos/onenote_imagen-003.png","fotos/onenote_imagen-004.png","fotos/onenote_imagen-005.png","fotos/onenote_imagen-006.png","fotos/onenote_imagen-007.png","fotos/onenote_imagen-008.png","fotos/onenote_imagen-009.png","fotos/onenote_imagen-010.png","fotos/onenote_imagen-011.png","fotos/onenote_imagen-012.png","fotos/onenote_imagen-013.png","fotos/onenote_imagen-014.png","fotos/onenote_imagen-015.png","fotos/onenote_imagen-016.png","fotos/onenote_imagen-017.png","fotos/onenote_imagen-018.png","fotos/onenote_imagen-019.png","fotos/onenote_imagen-020.png","fotos/onenote_imagen-021.png","fotos/onenote_imagen-022.png","fotos/onenote_imagen-023.png","fotos/onenote_imagen-024.png","fotos/onenote_imagen-025.png","fotos/onenote_imagen-026.png","fotos/onenote_imagen-027.png","fotos/onenote_imagen-028.png","fotos/onenote_imagen-029.png","fotos/onenote_imagen-030.png","fotos/onenote_imagen-031.png","fotos/onenote_imagen-032.png","fotos/onenote_imagen-033.png","fotos/onenote_imagen-034.png","fotos/onenote_imagen-035.png","fotos/onenote_imagen-036.png","fotos/onenote_imagen-037.png","fotos/onenote_imagen-038.png","fotos/onenote_imagen-039.png","fotos/onenote_imagen-040.png","fotos/onenote_imagen-041.png","fotos/onenote_imagen-042.png","fotos/onenote_imagen-043.png","fotos/onenote_imagen-044.png","fotos/onenote_imagen-045.png","fotos/onenote_imagen-046.png"],"seguimiento":{"responsable":"","contactado":false,"respuestaRecibida":false,"proximaAccion":"","fechaSeguimiento":"","acciones":[],"estado":"pendiente","email":""},"departamento":"Lizarte"}]};
            appData = JSON.parse(JSON.stringify(DATOS_EMBEBIDOS));
            
            records.forEach(record => {
                const fields = record.fields;
                
                // Guardar mapeo ID -> Airtable Record ID
                if (fields.ID) {
                    airtableRecords[fields.ID] = record.id;
                }
                
                if (fields.Tipo === 'Reuni√≥n') {
                    appData.reuniones.push({
                        id: fields.ID || record.id,
                        company: fields.Empresa || '',
                        person: fields.Persona || '',
                        product: fields.Producto || '',
                        time: fields.Hora || '',
                        stand: fields.Stand || '',
                        comments: fields.Notas || '',
                        departamento: fields.Departamento || 'Lizarte',
                        fotos: [],
                        fotos_extra: [],
                        seguimiento: {
                            responsable: fields.Responsable || '',
                            email: fields.Email || '',
                            estado: fields.Estado || 'pendiente',
                            acciones: fields.Acciones ? fields.Acciones.split('\n').filter(a => a.trim()) : [],
                            fechaSeguimiento: fields.Fecha_Seguimiento || ''
                        }
                    });
                } else if (fields.Tipo === 'Info Adicional') {
                    appData.adicional.push({
                        id: fields.ID || record.id,
                        empresa: fields.Empresa || '',
                        producto: fields.Producto || '',
                        prioridad: fields.Prioridad || 'media',
                        notas: fields.Notas || '',
                        oportunidad: fields.Oportunidad || '',
                        departamento: fields.Departamento || 'Lizarte',
                        fotos: [],
                        fotos_extra: [],
                        seguimiento: {
                            responsable: fields.Responsable || '',
                            email: fields.Email || '',
                            estado: fields.Estado || 'pendiente',
                            acciones: fields.Acciones ? fields.Acciones.split('\n').filter(a => a.trim()) : [],
                            fechaSeguimiento: fields.Fecha_Seguimiento || ''
                        }
                    });
                }
            });
            
            // Guardar mapeo actualizado
            localStorage.setItem('airtable_records_map', JSON.stringify(airtableRecords));
        }
        
        
        function loadConfig() {
            const saved = localStorage.getItem('config_automechanika');
            if (saved) {
                appConfig = JSON.parse(saved);
                document.getElementById('configTitulo').value = appConfig.titulo;
                document.getElementById('configSubtitulo').value = appConfig.subtitulo;
                document.getElementById('configEquipo').value = appConfig.equipo;
                document.getElementById('configNotas').value = appConfig.notas || '';
                
                document.querySelector('h1').textContent = appConfig.titulo;
                document.querySelector('.subtitle').textContent = appConfig.subtitulo;
            }
            
            equipoLizarte = appConfig.equipo.split(',').map(e => e.trim());
        }
        
        function saveConfig() {
            appConfig.titulo = document.getElementById('configTitulo').value;
            appConfig.subtitulo = document.getElementById('configSubtitulo').value;
            appConfig.equipo = document.getElementById('configEquipo').value;
            appConfig.notas = document.getElementById('configNotas').value;
            
            localStorage.setItem('config_automechanika', JSON.stringify(appConfig));
            
            document.querySelector('h1').textContent = appConfig.titulo;
            document.querySelector('.subtitle').textContent = appConfig.subtitulo;
            
            equipoLizarte = appConfig.equipo.split(',').map(e => e.trim());
            populateResponsableFilter();
            renderAll();
            
            showSaveIndicator();
            alert('‚úÖ Configuraci√≥n guardada');
        }
        
        function loadSeguimiento() {
            const saved = localStorage.getItem('seguimiento_v2_automechanika');
            if (saved) {
                const seguimientoData = JSON.parse(saved);
                
                appData.reuniones.forEach(item => {
                    if (seguimientoData[item.id]) {
                        item.seguimiento = seguimientoData[item.id];
                        if (!item.seguimiento.acciones) item.seguimiento.acciones = [];
                        if (!item.seguimiento.estado) item.seguimiento.estado = 'pendiente';
                        if (!item.seguimiento.email) item.seguimiento.email = '';
                        if (!item.fotos_extra) item.fotos_extra = [];
                    }
                });
                
                appData.adicional.forEach(item => {
                    if (seguimientoData[item.id]) {
                        item.seguimiento = seguimientoData[item.id];
                        if (!item.seguimiento.acciones) item.seguimiento.acciones = [];
                        if (!item.seguimiento.estado) item.seguimiento.estado = 'pendiente';
                        if (!item.seguimiento.email) item.seguimiento.email = '';
                    }
                });
            }
            
            // Cargar fotos borradas
            const deletedPhotos = localStorage.getItem('deleted_photos_automechanika');
            if (deletedPhotos) {
                const deletedList = JSON.parse(deletedPhotos);
                appData.reuniones.forEach(item => {
                    const itemDeleted = deletedList[item.id];
                    if (itemDeleted && itemDeleted.length > 0) {
                        // Filtrar fotos borradas
                        item.fotos = item.fotos.filter((foto, idx) => !itemDeleted.includes(idx));
                    }
                });
            }
            
            // Cargar fotos extra
            const fotosExtra = localStorage.getItem('fotos_extra_automechanika');
            if (fotosExtra) {
                const fotosExtraData = JSON.parse(fotosExtra);
                appData.reuniones.forEach(item => {
                    if (fotosExtraData[item.id]) {
                        item.fotos_extra = fotosExtraData[item.id];
                    }
                });
            }
            
            // Cargar textos modificados
            const textosModificados = localStorage.getItem('textos_modificados_automechanika');
            if (textosModificados) {
                const textosData = JSON.parse(textosModificados);
                appData.reuniones.forEach(item => {
                    if (textosData[item.id]) {
                        Object.keys(textosData[item.id]).forEach(field => {
                            item[field] = textosData[item.id][field];
                        });
                    }
                });
                appData.adicional.forEach(item => {
                    if (textosData[item.id]) {
                        Object.keys(textosData[item.id]).forEach(field => {
                            item[field] = textosData[item.id][field];
                        });
                    }
                });
            }
            
            // Inicializar campos nuevos
            appData.reuniones.forEach(item => {
                if (!item.seguimiento.acciones) item.seguimiento.acciones = [];
                if (!item.seguimiento.estado) item.seguimiento.estado = 'pendiente';
                if (!item.seguimiento.email) item.seguimiento.email = '';
                if (!item.fotos_extra) item.fotos_extra = [];
            });
            
            appData.adicional.forEach(item => {
                if (!item.seguimiento.acciones) item.seguimiento.acciones = [];
                if (!item.seguimiento.estado) item.seguimiento.estado = 'pendiente';
                if (!item.seguimiento.email) item.seguimiento.email = '';
                if (!item.fotos) item.fotos = [];
                if (!item.fotos_extra) item.fotos_extra = [];
            });
        }
        
        function saveSeguimiento() {
            const seguimientoData = {};
            
            appData.reuniones.forEach(item => {
                seguimientoData[item.id] = item.seguimiento;
            });
            
            appData.adicional.forEach(item => {
                seguimientoData[item.id] = item.seguimiento;
            });
            
            localStorage.setItem('seguimiento_v2_automechanika', JSON.stringify(seguimientoData));
            
            // Guardar fotos extra
            const fotosExtra = {};
            appData.reuniones.forEach(item => {
                if (item.fotos_extra && item.fotos_extra.length > 0) {
                    fotosExtra[item.id] = item.fotos_extra;
                }
            });
            localStorage.setItem('fotos_extra_automechanika', JSON.stringify(fotosExtra));
            
            showSaveIndicator();
            updateStats();
        }
        
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 2000);
        }
        
        function updateStats() {
            const allItems = [...appData.reuniones, ...appData.adicional];
            const total = allItems.length;
            const pendientes = allItems.filter(i => i.seguimiento.estado === 'pendiente').length;
            const contactados = allItems.filter(i => i.seguimiento.estado === 'contactado').length;
            const proceso = allItems.filter(i => i.seguimiento.estado === 'proceso').length;
            const finalizados = allItems.filter(i => i.seguimiento.estado === 'finalizado').length;
            
            document.getElementById('statTotal').textContent = total;
            document.getElementById('statPendientes').textContent = pendientes;
            document.getElementById('statContactados').textContent = contactados;
            document.getElementById('statProceso').textContent = proceso;
            document.getElementById('statFinalizados').textContent = finalizados;
        }
        
        function populateResponsableFilter() {
            const select = document.getElementById('filterResponsable');
            select.innerHTML = '<option value="">Todos</option>';
            equipoLizarte.forEach(nombre => {
                const option = document.createElement('option');
                option.value = nombre;
                option.textContent = nombre;
                select.appendChild(option);
            });
        }
        
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + 'Section').classList.add('active');
        }
        
        function renderAll() {
            renderReuniones();
            renderAdicional();
        }
        
        function applyFilters() {
            renderAll();
        }
        
        function applyFiltersToData(items) {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const departamento = document.getElementById('filterDepartamento').value;
            const responsable = document.getElementById('filterResponsable').value;
            const estado = document.getElementById('filterEstado').value;
            
            return items.filter(item => {
                const matchSearch = !search || 
                    item.company?.toLowerCase().includes(search) ||
                    item.empresa?.toLowerCase().includes(search) ||
                    item.product?.toLowerCase().includes(search) ||
                    item.producto?.toLowerCase().includes(search);
                
                const matchDepartamento = !departamento || (item.departamento || 'Lizarte') === departamento;
                const matchResponsable = !responsable || item.seguimiento.responsable === responsable;
                const matchEstado = !estado || item.seguimiento.estado === estado;
                
                return matchSearch && matchDepartamento && matchResponsable && matchEstado;
            });
        }
        
        function renderReuniones() {
            const container = document.getElementById('reunionesContainer');
            const filtered = applyFiltersToData(appData.reuniones);
            
            container.innerHTML = filtered.map((item, idx) => {
                const realIdx = appData.reuniones.indexOf(item);
                const allFotos = [...item.fotos, ...(item.fotos_extra || [])];
                
                return `
                <div class="item-card">
                    <div class="item-header">
                        <div class="item-company" id="company-title-reuniones-${realIdx}">
                            ${item.company}
                            <span class="depto-badge depto-${item.departamento?.toLowerCase() || 'lizarte'}">${item.departamento || 'Lizarte'}</span>
                        </div>
                        <div class="item-meta" id="meta-reuniones-${realIdx}">
                            <span>üë§ ${item.person}</span>
                            <span>üì¶ ${item.product}</span>
                        </div>
                    </div>
                    <div class="item-body">
                        <div class="form-group">
                            <label>üè¢ Datos de la Empresa</label>
                            <div style="display: grid; gap: 8px;">
                                <input type="text" value="${item.company}" 
                                    onchange="updateTextoConTitulo('reuniones', ${realIdx}, 'company', this.value)"
                                    placeholder="Nombre empresa" style="font-weight: 600;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px;">
                                    <input type="text" value="${item.person}" 
                                        onchange="updateTexto('reuniones', ${realIdx}, 'person', this.value)"
                                        placeholder="Persona contacto">
                                    <input type="text" value="${item.product}" 
                                        onchange="updateTextoConTitulo('reuniones', ${realIdx}, 'product', this.value)"
                                        placeholder="Producto">
                                    <select onchange="updateTexto('reuniones', ${realIdx}, 'departamento', this.value)" style="padding: 8px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 13px;">
                                        <option value="Lizarte" ${(item.departamento || 'Lizarte') === 'Lizarte' ? 'selected' : ''}>üîµ Lizarte</option>
                                        <option value="Innovaci√≥n" ${item.departamento === 'Innovaci√≥n' ? 'selected' : ''}>‚≠ê Innovaci√≥n</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>üìù Notas / Comentarios</label>
                            <textarea 
                                onchange="updateTexto('reuniones', ${realIdx}, 'comments', this.value)"
                                placeholder="A√±ade notas o comentarios sobre esta reuni√≥n..."
                                style="min-height: 80px;">${item.comments || ''}</textarea>
                        </div>
                        
                        <div class="fotos-section">
                            <div class="fotos-section-title">üì∑ Fotos (${allFotos.length})</div>
                            ${allFotos.length > 0 ? `
                                <div class="fotos-grid">
                                    ${allFotos.map((foto, fIdx) => `
                                        <div class="foto-item">
                                            <img src="${foto}" class="foto-thumb" onclick="openModal('${foto}')" alt="Foto">
                                            <button class="foto-delete" onclick="deleteFoto('reuniones', ${realIdx}, ${fIdx})">√ó</button>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : '<p style="font-size: 12px; color: #9ca3af;">Sin fotos</p>'}
                        </div>
                        
                        ${renderSeguimiento('reuniones', realIdx, item)}
                    </div>
                </div>
            `}).join('');
        }
        
        function renderAdicional() {
            const container = document.getElementById('adicionalContainer');
            const filtered = applyFiltersToData(appData.adicional);
            
            container.innerHTML = filtered.map((item, idx) => {
                const realIdx = appData.adicional.indexOf(item);
                const allFotos = [...(item.fotos || []), ...(item.fotos_extra || [])];
                
                return `
                <div class="item-card">
                    <div class="item-header">
                        <div class="item-company" id="company-title-adicional-${realIdx}">
                            ${item.empresa}
                            <span class="depto-badge depto-${item.departamento?.toLowerCase() || 'lizarte'}">${item.departamento || 'Lizarte'}</span>
                        </div>
                        <div class="item-meta" id="meta-adicional-${realIdx}">
                            <span>üì¶ ${item.producto}</span>
                            <span class="priority-badge priority-${item.prioridad}">${item.prioridad.toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="item-body">
                        <div class="form-group">
                            <label>üè¢ Informaci√≥n B√°sica</label>
                            <div style="display: grid; gap: 8px;">
                                <input type="text" value="${item.empresa}" 
                                    onchange="updateTextoConTitulo('adicional', ${realIdx}, 'company', this.value)"
                                    placeholder="Nombre empresa" style="font-weight: 600;">
                                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 8px;">
                                    <input type="text" value="${item.producto}" 
                                        onchange="updateTextoConTitulo('adicional', ${realIdx}, 'producto', this.value)"
                                        placeholder="Producto / Servicio">
                                    <select onchange="updateTexto('adicional', ${realIdx}, 'departamento', this.value)" style="padding: 8px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 13px;">
                                        <option value="Lizarte" ${(item.departamento || 'Lizarte') === 'Lizarte' ? 'selected' : ''}>üîµ Lizarte</option>
                                        <option value="Innovaci√≥n" ${item.departamento === 'Innovaci√≥n' ? 'selected' : ''}>‚≠ê Innovaci√≥n</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>üìù Notas</label>
                            <textarea 
                                onchange="updateTexto('adicional', ${realIdx}, 'notas', this.value)"
                                placeholder="A√±ade notas sobre esta empresa..."
                                style="min-height: 60px;">${item.notas || ''}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>üí° Oportunidad</label>
                            <textarea 
                                onchange="updateTexto('adicional', ${realIdx}, 'oportunidad', this.value)"
                                placeholder="Describe la oportunidad de negocio..."
                                style="min-height: 60px;">${item.oportunidad || ''}</textarea>
                        </div>
                        
                        ${allFotos.length > 0 ? `
                            <div class="fotos-section">
                                <div class="fotos-section-title">üì∑ Fotos (${allFotos.length})</div>
                                <div class="fotos-grid">
                                    ${allFotos.map((foto, fIdx) => `
                                        <div class="foto-item">
                                            <img src="${foto}" class="foto-thumb" onclick="openModal('${foto}')" alt="Foto">
                                            <button class="foto-delete" onclick="deleteFoto('adicional', ${realIdx}, ${fIdx})">√ó</button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : `
                            <div class="fotos-section">
                                <div class="fotos-section-title">üì∑ Fotos (0)</div>
                                <p style="font-size: 12px; color: #9ca3af; margin-bottom: 8px;">Sin fotos</p>
                            </div>
                        `}
                        
                        ${renderSeguimiento('adicional', realIdx, item)}
                    </div>
                </div>
            `}).join('');
        }
        
        function renderSeguimiento(type, index, item) {
            const seg = item.seguimiento;
            const id = item.id || index;
            
            return `
                <div class="seguimiento-box">
                    <div class="seguimiento-title">üìã Seguimiento</div>
                    
                    <div class="form-group">
                        <label>Estado</label>
                        <div class="estado-selector">
                            <div class="estado-option estado-pendiente">
                                <input type="radio" id="estado_${type}_${id}_pendiente" name="estado_${type}_${id}" value="pendiente" 
                                    ${seg.estado === 'pendiente' ? 'checked' : ''}
                                    onchange="updateEstado('${type}', ${index}, 'pendiente')">
                                <label for="estado_${type}_${id}_pendiente">‚ö™ Pendiente</label>
                            </div>
                            <div class="estado-option estado-contactado">
                                <input type="radio" id="estado_${type}_${id}_contactado" name="estado_${type}_${id}" value="contactado"
                                    ${seg.estado === 'contactado' ? 'checked' : ''}
                                    onchange="updateEstado('${type}', ${index}, 'contactado')">
                                <label for="estado_${type}_${id}_contactado">üü° Contactado</label>
                            </div>
                            <div class="estado-option estado-proceso">
                                <input type="radio" id="estado_${type}_${id}_proceso" name="estado_${type}_${id}" value="proceso"
                                    ${seg.estado === 'proceso' ? 'checked' : ''}
                                    onchange="updateEstado('${type}', ${index}, 'proceso')">
                                <label for="estado_${type}_${id}_proceso">üîµ En Proceso</label>
                            </div>
                            <div class="estado-option estado-finalizado">
                                <input type="radio" id="estado_${type}_${id}_finalizado" name="estado_${type}_${id}" value="finalizado"
                                    ${seg.estado === 'finalizado' ? 'checked' : ''}
                                    onchange="updateEstado('${type}', ${index}, 'finalizado')">
                                <label for="estado_${type}_${id}_finalizado">üü¢ Finalizado</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group" style="margin: 0;">
                            <label>Responsable</label>
                            <select onchange="updateSeguimiento('${type}', ${index}, 'responsable', this.value)">
                                <option value="">Sin asignar</option>
                                ${equipoLizarte.map(nombre => `
                                    <option value="${nombre}" ${seg.responsable === nombre ? 'selected' : ''}>${nombre}</option>
                                `).join('')}
                            </select>
                        </div>
                        <div class="form-group" style="margin: 0;">
                            <label>Email</label>
                            <input type="email" value="${seg.email || ''}" 
                                onchange="updateSeguimiento('${type}', ${index}, 'email', this.value)"
                                placeholder="email@ejemplo.com">
                        </div>
                    </div>
                    
                    ${seg.email ? `
                        <button class="btn-notify" onclick="sendNotification('${type}', ${index})">
                            üìß Enviar Notificaci√≥n
                        </button>
                    ` : ''}
                    
                    <div class="form-group">
                        <label>Pr√≥ximas Acciones</label>
                        <div class="acciones-list">
                            ${seg.acciones && seg.acciones.length > 0 ? seg.acciones.map((accion, aIdx) => `
                                <div class="accion-item">
                                    <textarea onchange="updateAccion('${type}', ${index}, ${aIdx}, this.value)"
                                        placeholder="Descripci√≥n de la acci√≥n...">${accion}</textarea>
                                    <button class="btn-delete-accion" onclick="deleteAccion('${type}', ${index}, ${aIdx})">üóëÔ∏è</button>
                                </div>
                            `).join('') : '<p style="font-size: 12px; color: #9ca3af; margin-bottom: 8px;">Sin acciones definidas</p>'}
                        </div>
                        <button class="btn-add-accion" onclick="addAccion('${type}', ${index})">‚ûï A√±adir Acci√≥n</button>
                    </div>
                </div>
            `;
        }
        
        function renderDocumentacion(type, index, item) {
            const docs = item.documentos || [];
            
            return `
                <div class="seguimiento-section" style="margin-top: 15px;">
                    <div class="seguimiento-title">üìé Documentaci√≥n</div>
                    
                    <div class="form-group">
                        ${docs.length > 0 ? `
                            <div style="display: grid; gap: 8px; margin-bottom: 12px;">
                                ${docs.map((doc, dIdx) => `
                                    <div style="display: flex; align-items: center; gap: 8px; padding: 10px; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb;">
                                        <span style="flex: 1;">
                                            ${doc.tipo === 'link' ? 'üîó' : 'üìÑ'} 
                                            ${doc.tipo === 'link' ? 
                                                `<a href="${doc.url}" target="_blank" style="color: #3b82f6; text-decoration: underline;">${doc.nombre}</a>` : 
                                                `<span>${doc.nombre}</span>`
                                            }
                                        </span>
                                        <button class="btn-delete-accion" onclick="deleteDocumento('${type}', ${index}, ${dIdx})" style="padding: 4px 8px;">üóëÔ∏è</button>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<p style="font-size: 12px; color: #9ca3af; margin-bottom: 12px;">Sin documentos adjuntos</p>'}
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <button class="btn-add-accion" onclick="addDocumentoLink('${type}', ${index})">üîó A√±adir Link Email</button>
                            <button class="btn-add-accion" onclick="addDocumentoArchivo('${type}', ${index})">üìÑ Subir Cat√°logo</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function updateSeguimiento(type, index, field, value) {
            if (type === 'reuniones') {
                appData.reuniones[index].seguimiento[field] = value;
            } else {
                appData.adicional[index].seguimiento[field] = value;
            }
            saveSeguimiento();
        }
        
        function updateTexto(type, index, field, value) {
            if (type === 'reuniones') {
                appData.reuniones[index][field] = value;
            } else {
                appData.adicional[index][field] = value;
            }
            
            // Guardar textos modificados en localStorage
            const textosData = JSON.parse(localStorage.getItem('textos_modificados_automechanika') || '{}');
            const itemId = type === 'reuniones' ? appData.reuniones[index].id : appData.adicional[index].id;
            
            if (!textosData[itemId]) textosData[itemId] = {};
            textosData[itemId][field] = value;
            
            localStorage.setItem('textos_modificados_automechanika', JSON.stringify(textosData));
            showSaveIndicator();
        }
        
        function updateTextoConTitulo(type, index, field, value) {
            // Mapear campo si es necesario (adicional usa 'empresa' en lugar de 'company')
            let actualField = field;
            if (type === 'adicional' && field === 'company') {
                actualField = 'empresa';
            }
            
            // Actualizar datos
            updateTexto(type, index, actualField, value);
            
            // Actualizar t√≠tulo en tiempo real
            if (field === 'company' && type === 'reuniones') {
                const titleElement = document.getElementById(`company-title-reuniones-${index}`);
                if (titleElement) {
                    const item = appData.reuniones[index];
                    const badge = titleElement.querySelector('.depto-badge');
                    const badgeHTML = badge ? badge.outerHTML : '';
                    titleElement.innerHTML = `${value || item.company} ${badgeHTML}`;
                }
            } else if (field === 'company' && type === 'adicional') {
                const titleElement = document.getElementById(`company-title-adicional-${index}`);
                if (titleElement) {
                    const item = appData.adicional[index];
                    const badge = titleElement.querySelector('.depto-badge');
                    const badgeHTML = badge ? badge.outerHTML : '';
                    titleElement.innerHTML = `${value || item.empresa} ${badgeHTML}`;
                }
            }
            
            // Actualizar metadata (persona y producto)
            if ((field === 'person' || field === 'product') && type === 'reuniones') {
                const metaElement = document.getElementById(`meta-reuniones-${index}`);
                if (metaElement) {
                    const item = appData.reuniones[index];
                    metaElement.innerHTML = `
                        <span>üë§ ${item.person}</span>
                        <span>üì¶ ${item.product}</span>
                    `;
                }
            } else if (field === 'producto' && type === 'adicional') {
                const metaElement = document.getElementById(`meta-adicional-${index}`);
                if (metaElement) {
                    const item = appData.adicional[index];
                    metaElement.innerHTML = `
                        <span>üì¶ ${item.producto}</span>
                        <span class="priority-badge priority-${item.prioridad}">${item.prioridad.toUpperCase()}</span>
                    `;
                }
            }
        }
        
        function updateEstado(type, index, estado) {
            updateSeguimiento(type, index, 'estado', estado);
            renderAll();
        }
        
        function addAccion(type, index) {
            const item = type === 'reuniones' ? appData.reuniones[index] : appData.adicional[index];
            if (!item.seguimiento.acciones) item.seguimiento.acciones = [];
            item.seguimiento.acciones.push('');
            saveSeguimiento();
            renderAll();
        }
        
        function updateAccion(type, index, accionIdx, value) {
            const item = type === 'reuniones' ? appData.reuniones[index] : appData.adicional[index];
            item.seguimiento.acciones[accionIdx] = value;
            saveSeguimiento();
        }
        
        function deleteAccion(type, index, accionIdx) {
            if (!confirm('¬øEliminar esta acci√≥n?')) return;
            const item = type === 'reuniones' ? appData.reuniones[index] : appData.adicional[index];
            item.seguimiento.acciones.splice(accionIdx, 1);
            saveSeguimiento();
            renderAll();
        }
        
        function addFoto(type, index) {
            currentUploadTarget = { type, index };
            document.getElementById('fileInput').click();
        }
        
        function handleFileUpload(event) {
            const files = event.target.files;
            if (!files.length || !currentUploadTarget) return;
            
            const { type, index } = currentUploadTarget;
            const item = type === 'reuniones' ? appData.reuniones[index] : appData.adicional[index];
            
            if (!item.fotos_extra) item.fotos_extra = [];
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    item.fotos_extra.push(e.target.result);
                    saveSeguimiento();
                    renderAll();
                };
                reader.readAsDataURL(file);
            });
            
            event.target.value = '';
        }
        
        function deleteFoto(type, index, fotoIdx) {
            if (!confirm('¬øEliminar esta foto? (Podr√°s recuperarla desde la papelera)')) return;
            
            const item = type === 'reuniones' ? appData.reuniones[index] : appData.adicional[index];
            const allFotos = [...item.fotos, ...(item.fotos_extra || [])];
            const fotoUrl = allFotos[fotoIdx];
            
            // Guardar en papelera
            const papelera = JSON.parse(localStorage.getItem('papelera_fotos_automechanika') || '{}');
            if (!papelera[item.id]) papelera[item.id] = [];
            
            papelera[item.id].push({
                url: fotoUrl,
                fecha: new Date().toISOString(),
                tipo: fotoIdx < item.fotos.length ? 'original' : 'extra',
                indice: fotoIdx
            });
            
            localStorage.setItem('papelera_fotos_automechanika', JSON.stringify(papelera));
            
            // Eliminar del array correspondiente
            if (fotoIdx < item.fotos.length) {
                item.fotos.splice(fotoIdx, 1);
            } else {
                const extraIdx = fotoIdx - item.fotos.length;
                item.fotos_extra.splice(extraIdx, 1);
            }
            
            saveSeguimiento();
            renderAll();
        }
        
        function verPapelera(type, index) {
            const item = type === 'reuniones' ? appData.reuniones[index] : appData.adicional[index];
            const papelera = JSON.parse(localStorage.getItem('papelera_fotos_automechanika') || '{}');
            const fotosBorradas = papelera[item.id] || [];
            
            if (fotosBorradas.length === 0) {
                alert('No hay fotos borradas para recuperar');
                return;
            }
            
            const html = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; align-items: center; justify-content: center; padding: 20px;" id="papeleraModal" onclick="cerrarPapelera(event)">
                    <div style="background: white; border-radius: 16px; padding: 20px; max-width: 600px; max-height: 80vh; overflow-y: auto;" onclick="event.stopPropagation()">
                        <h3 style="margin-bottom: 15px;">‚ôªÔ∏è Papelera de Fotos</h3>
                        <p style="font-size: 13px; color: #6b7280; margin-bottom: 15px;">Haz clic en una foto para recuperarla</p>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px;">
                            ${fotosBorradas.map((foto, idx) => `
                                <div style="position: relative; cursor: pointer;" onclick="recuperarFoto('${type}', ${index}, ${idx})">
                                    <img src="${foto.url}" style="width: 100%; height: 100px; object-fit: cover; border-radius: 8px; border: 2px solid #e5e7eb;">
                                    <div style="position: absolute; bottom: 4px; right: 4px; background: #10b981; color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px;">Recuperar</div>
                                </div>
                            `).join('')}
                        </div>
                        <button onclick="cerrarPapelera()" style="margin-top: 15px; width: 100%; padding: 10px; background: #6b7280; color: white; border: none; border-radius: 8px; cursor: pointer;">Cerrar</button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', html);
        }
        
        function recuperarFoto(type, index, papeleraIdx) {
            const item = type === 'reuniones' ? appData.reuniones[index] : appData.adicional[index];
            const papelera = JSON.parse(localStorage.getItem('papelera_fotos_automechanika') || '{}');
            const fotosBorradas = papelera[item.id] || [];
            
            if (fotosBorradas[papeleraIdx]) {
                const foto = fotosBorradas[papeleraIdx];
                
                // Restaurar foto
                if (!item.fotos_extra) item.fotos_extra = [];
                item.fotos_extra.push(foto.url);
                
                // Eliminar de papelera
                fotosBorradas.splice(papeleraIdx, 1);
                papelera[item.id] = fotosBorradas;
                localStorage.setItem('papelera_fotos_automechanika', JSON.stringify(papelera));
                
                saveSeguimiento();
                cerrarPapelera();
                renderAll();
                
                alert('‚úÖ Foto recuperada');
            }
        }
        
        function cerrarPapelera(event) {
            if (event && event.target.id !== 'papeleraModal') return;
            const modal = document.getElementById('papeleraModal');
            if (modal) modal.remove();
        }
        
        // ========== FUNCIONES DOCUMENTACI√ìN ==========
        
        function addDocumentoLink(type, index) {
            const nombre = prompt('T√≠tulo del documento/email:');
            if (!nombre) return;
            
            const url = prompt('URL o link del email:');
            if (!url) return;
            
            const item = type === 'reuniones' ? appData.reuniones[index] : appData.adicional[index];
            if (!item.documentos) item.documentos = [];
            
            item.documentos.push({
                tipo: 'link',
                nombre: nombre,
                url: url,
                fecha: new Date().toISOString()
            });
            
            saveDocumentos();
            renderAll();
        }
        
        function addDocumentoArchivo(type, index) {
            currentUploadTarget = { type, index, isDoc: true };
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png';
            input.multiple = false;
            
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                // Validar tama√±o (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert('El archivo es demasiado grande. M√°ximo 5MB.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    const item = type === 'reuniones' ? appData.reuniones[index] : appData.adicional[index];
                    if (!item.documentos) item.documentos = [];
                    
                    item.documentos.push({
                        tipo: 'archivo',
                        nombre: file.name,
                        data: event.target.result,
                        tamano: file.size,
                        fecha: new Date().toISOString()
                    });
                    
                    saveDocumentos();
                    renderAll();
                };
                
                reader.readAsDataURL(file);
            };
            
            input.click();
        }
        
        function deleteDocumento(type, index, docIdx) {
            if (!confirm('¬øEliminar este documento?')) return;
            
            const item = type === 'reuniones' ? appData.reuniones[index] : appData.adicional[index];
            if (item.documentos) {
                item.documentos.splice(docIdx, 1);
            }
            
            saveDocumentos();
            renderAll();
        }
        
        function saveDocumentos() {
            const docsData = {};
            
            appData.reuniones.forEach(item => {
                if (item.documentos && item.documentos.length > 0) {
                    docsData[item.id] = item.documentos;
                }
            });
            
            appData.adicional.forEach(item => {
                if (item.documentos && item.documentos.length > 0) {
                    docsData[item.id] = item.documentos;
                }
            });
            
            localStorage.setItem('documentos_automechanika', JSON.stringify(docsData));
            showSaveIndicator();
        }
        
        function loadDocumentos() {
            const docsData = JSON.parse(localStorage.getItem('documentos_automechanika') || '{}');
            
            appData.reuniones.forEach(item => {
                if (docsData[item.id]) {
                    item.documentos = docsData[item.id];
                }
            });
            
            appData.adicional.forEach(item => {
                if (docsData[item.id]) {
                    item.documentos = docsData[item.id];
                }
            });
        }
        
        function sendNotification(type, index) {
            const item = type === 'reuniones' ? appData.reuniones[index] : appData.adicional[index];
            const seg = item.seguimiento;
            const empresa = item.company || item.empresa;
            
            if (!seg.email) {
                alert('No hay email configurado');
                return;
            }
            
            const subject = `Acci√≥n pendiente - ${empresa}`;
            const body = `Hola ${seg.responsable || ''},

Tienes una acci√≥n pendiente de seguimiento:

Empresa: ${empresa}
Estado: ${seg.estado.toUpperCase()}
${seg.fechaSeguimiento ? `Fecha seguimiento: ${seg.fechaSeguimiento}` : ''}

${seg.acciones && seg.acciones.length > 0 ? `Acciones pendientes:
${seg.acciones.map((a, i) => `${i + 1}. ${a}`).join('\n')}` : ''}

Puedes ver m√°s detalles en:
https://krumkk.github.io/seguimiento-automechanika-2025/

Saludos,
Sistema de Seguimiento Automechanika`;
            
            const mailto = `mailto:${seg.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailto;
        }
        
        function openModal(src) {
            document.getElementById('modalImage').src = src;
            document.getElementById('photoModal').classList.add('show');
        }
        
        function closeModal() {
            document.getElementById('photoModal').classList.remove('show');
        }
        
        async function exportarDatosActualizados(evt) {
            let button = null;
            let originalText = 'üì§ EXPORTAR';
            
            try {
                button = evt && evt.target ? evt.target : document.querySelector('.btn-float-export');
                if (button) {
                    originalText = button.innerHTML;
                    button.innerHTML = '‚è≥ Exportando...';
                    button.disabled = true;
                }
                
                console.log('üì§ Iniciando exportaci√≥n de datos actualizados...');
                
                // Cargar datos base
                console.log('üì• Cargando datos.json...');
                const response = await fetch('datos.json');
                if (!response.ok) {
                    throw new Error('No se pudo cargar datos.json');
                }
                const datosBase = await response.json();
                console.log('‚úÖ datos.json cargado:', datosBase);
                
                // Aplicar textos modificados
                console.log('üìù Aplicando textos modificados...');
                const textosModificados = JSON.parse(localStorage.getItem('textos_modificados_automechanika') || '{}');
                
                datosBase.reuniones.forEach(item => {
                    if (textosModificados[item.id]) {
                        Object.assign(item, textosModificados[item.id]);
                    }
                });
                
                datosBase.adicional.forEach(item => {
                    if (textosModificados[item.id]) {
                        Object.assign(item, textosModificados[item.id]);
                    }
                });
                
                // Aplicar seguimiento
                console.log('üìä Aplicando seguimiento...');
                const seguimientoData = JSON.parse(localStorage.getItem('seguimiento_v2_automechanika') || '{}');
                
                datosBase.reuniones.forEach(item => {
                    if (seguimientoData[item.id]) {
                        item.seguimiento = seguimientoData[item.id];
                    }
                });
                
                datosBase.adicional.forEach(item => {
                    if (seguimientoData[item.id]) {
                        item.seguimiento = seguimientoData[item.id];
                    }
                });
                
                // Aplicar fotos borradas (eliminarlas del JSON)
                console.log('üóëÔ∏è Aplicando fotos borradas...');
                const deletedPhotosData = JSON.parse(localStorage.getItem('deleted_photos_automechanika') || '{}');
                
                datosBase.reuniones.forEach(item => {
                    if (deletedPhotosData[item.id] && deletedPhotosData[item.id].length > 0) {
                        const deletedIndices = deletedPhotosData[item.id];
                        item.fotos = item.fotos.filter((foto, idx) => !deletedIndices.includes(idx));
                    }
                });
                
                datosBase.adicional.forEach(item => {
                    if (deletedPhotosData[item.id] && deletedPhotosData[item.id].length > 0) {
                        const deletedIndices = deletedPhotosData[item.id];
                        item.fotos = item.fotos.filter((foto, idx) => !deletedIndices.includes(idx));
                    }
                });
                
                // Generar JSON
                console.log('üì¶ Generando archivo JSON...');
                const jsonString = JSON.stringify(datosBase, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                
                // Descargar
                console.log('üíæ Descargando archivo...');
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'datos.json';
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                
                // Limpiar
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                console.log('‚úÖ Datos exportados correctamente');
                
                // Restaurar bot√≥n (en un try-catch separado para no afectar el √©xito)
                try {
                    if (button) {
                        button.innerHTML = '‚úÖ ¬°Exportado!';
                        setTimeout(() => {
                            button.innerHTML = originalText;
                            button.disabled = false;
                        }, 2000);
                    }
                } catch (btnError) {
                    console.warn('‚ö†Ô∏è Error restaurando bot√≥n (no cr√≠tico):', btnError);
                }
                
                // Mostrar instrucciones (en un try-catch separado)
                try {
                    alert('‚úÖ Archivo datos.json descargado\n\nüì§ AHORA:\n\n1. Ve a GitHub\n2. Sube este archivo (reemplaza el anterior)\n3. Commit: "Datos actualizados"\n4. Comparte el enlace con tu equipo\n\n¬°Todos ver√°n tu informaci√≥n actualizada!');
                } catch (alertError) {
                    console.warn('‚ö†Ô∏è Error mostrando alert (no cr√≠tico):', alertError);
                }
                
            } catch (error) {
                console.error('‚ùå Error exportando datos:', error);
                console.error('Stack trace:', error.stack);
                
                // Intentar restaurar bot√≥n incluso si hay error
                try {
                    if (button) {
                        button.innerHTML = '‚ùå Error';
                        setTimeout(() => {
                            button.innerHTML = originalText;
                            button.disabled = false;
                        }, 2000);
                    }
                } catch (btnError) {
                    console.warn('‚ö†Ô∏è Error restaurando bot√≥n despu√©s de error:', btnError);
                }
                
                alert('‚ùå Error al exportar datos.\n\nError: ' + error.message + '\n\nRevisa la consola (F12) para m√°s detalles.');
            }
        }
        
        function exportarInforme() {
            let content = `${appConfig.titulo}\n`;
            content += `${appConfig.subtitulo}\n`;
            content += `Fecha: ${new Date().toLocaleDateString('es-ES')}\n\n`;
            content += '='.repeat(60) + '\n\n';
            
            if (appConfig.notas) {
                content += `NOTAS GENERALES:\n${appConfig.notas}\n\n`;
                content += '='.repeat(60) + '\n\n';
            }
            
            const allItems = [...appData.reuniones, ...appData.adicional];
            const pendientes = allItems.filter(i => i.seguimiento.estado === 'pendiente').length;
            const contactados = allItems.filter(i => i.seguimiento.estado === 'contactado').length;
            const proceso = allItems.filter(i => i.seguimiento.estado === 'proceso').length;
            const finalizados = allItems.filter(i => i.seguimiento.estado === 'finalizado').length;
            
            content += 'RESUMEN EJECUTIVO\n\n';
            content += `Total de contactos: ${allItems.length}\n`;
            content += `Pendientes: ${pendientes}\n`;
            content += `Contactados: ${contactados}\n`;
            content += `En proceso: ${proceso}\n`;
            content += `Finalizados: ${finalizados}\n\n`;
            content += '='.repeat(60) + '\n\n';
            
            content += `REUNIONES PROGRAMADAS (${appData.reuniones.length})\n\n`;
            appData.reuniones.sort((a, b) => a.time.localeCompare(b.time)).forEach(item => {
                content += `${item.company}\n${'‚îÄ'.repeat(item.company.length)}\n`;
                content += `Persona: ${item.person}\n`;
                content += `Producto: ${item.product}\n`;
                content += `Hora: ${item.time}\n`;
                if (item.stand) content += `Stand: ${item.stand}\n`;
                if (item.comments) content += `Notas: ${item.comments}\n`;
                
                const allFotos = [...item.fotos, ...(item.fotos_extra || [])];
                if (allFotos.length) content += `Fotos: ${allFotos.length}\n`;
                
                const seg = item.seguimiento;
                content += `\nSEGUIMIENTO:\n`;
                content += `  Estado: ${seg.estado.toUpperCase()}\n`;
                if (seg.responsable) content += `  Responsable: ${seg.responsable}\n`;
                if (seg.email) content += `  Email: ${seg.email}\n`;
                if (seg.acciones && seg.acciones.length > 0) {
                    content += `  Acciones pendientes:\n`;
                    seg.acciones.forEach((a, i) => {
                        if (a) content += `    ${i + 1}. ${a}\n`;
                    });
                }
                if (seg.fechaSeguimiento) content += `  Fecha seguimiento: ${seg.fechaSeguimiento}\n`;
                content += '\n';
            });
            
            content += '='.repeat(60) + '\n\n';
            content += `INFORMACI√ìN ADICIONAL (${appData.adicional.length})\n\n`;
            
            appData.adicional.forEach(item => {
                content += `${item.empresa}\n${'‚îÄ'.repeat(item.empresa.length)}\n`;
                content += `Producto: ${item.producto}\n`;
                content += `Prioridad: ${item.prioridad.toUpperCase()}\n`;
                if (item.notas) content += `Notas: ${item.notas}\n`;
                if (item.oportunidad) content += `Oportunidad: ${item.oportunidad}\n`;
                
                const seg = item.seguimiento;
                content += `\nSEGUIMIENTO:\n`;
                content += `  Estado: ${seg.estado.toUpperCase()}\n`;
                if (seg.responsable) content += `  Responsable: ${seg.responsable}\n`;
                if (seg.email) content += `  Email: ${seg.email}\n`;
                if (seg.acciones && seg.acciones.length > 0) {
                    content += `  Acciones pendientes:\n`;
                    seg.acciones.forEach((a, i) => {
                        if (a) content += `    ${i + 1}. ${a}\n`;
                    });
                }
                if (seg.fechaSeguimiento) content += `  Fecha seguimiento: ${seg.fechaSeguimiento}\n`;
                content += '\n';
            });
            
            content += '='.repeat(60) + '\n';
            content += `Fin del informe\n`;
            content += `Generado: ${new Date().toLocaleString('es-ES')}\n`;
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const fileName = `informe_seguimiento_v2_${new Date().toISOString().split('T')[0]}.txt`;
            
            if (navigator.share) {
                const file = new File([blob], fileName, { type: 'text/plain' });
                navigator.share({
                    files: [file],
                    title: 'Informe Seguimiento Automechanika v2.0',
                    text: 'Informe completo de seguimiento'
                }).catch(err => {
                    if (err.name !== 'AbortError') downloadFile(blob, fileName);
                });
            } else {
                downloadFile(blob, fileName);
            }
        }
        
        function downloadFile(blob, fileName) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // ========== SPLASH SCREEN FUNCTIONS ==========
        
        function initSplashScreen() {
            // Verificar si hay par√°metro URL para DESACTIVAR splash
            const urlParams = new URLSearchParams(window.location.search);
            const skipSplash = urlParams.get('nosplash') === '1';
            
            console.log('üöÄ Splash Screen Debug:', {
                skipSplash: skipSplash,
                willShow: !skipSplash
            });
            
            if (!skipSplash) {
                showSplash();
            } else {
                console.log('‚è≠Ô∏è Splash omitido por par√°metro URL');
            }
        }
        
        async function showSplash() {
            console.log('üé¨ Mostrando splash screen...');
            const splash = document.getElementById('splashScreen');
            
            if (!splash) {
                console.error('‚ùå No se encontr√≥ el elemento splashScreen');
                return;
            }
            
            splash.style.display = 'flex';
            
            // Generar part√≠culas
            generateParticles();
            
            // Cargar datos del JSON para calcular estad√≠sticas reales
            try {
                const response = await fetch('datos.json');
                const datos = await response.json();
                
                // Aplicar textos modificados (como en loadData)
                const textosModificados = JSON.parse(localStorage.getItem('textos_modificados_automechanika') || '{}');
                datos.reuniones.forEach(item => {
                    if (textosModificados[item.id]) {
                        Object.assign(item, textosModificados[item.id]);
                    }
                });
                datos.adicional.forEach(item => {
                    if (textosModificados[item.id]) {
                        Object.assign(item, textosModificados[item.id]);
                    }
                });
                
                // Aplicar seguimiento (para contar estados correctamente)
                const seguimientoData = JSON.parse(localStorage.getItem('seguimiento_v2_automechanika') || '{}');
                datos.reuniones.forEach(item => {
                    if (seguimientoData[item.id]) {
                        item.seguimiento = seguimientoData[item.id];
                    }
                });
                datos.adicional.forEach(item => {
                    if (seguimientoData[item.id]) {
                        item.seguimiento = seguimientoData[item.id];
                    }
                });
                
                // Aplicar fotos borradas
                const deletedPhotosData = JSON.parse(localStorage.getItem('deleted_photos_automechanika') || '{}');
                datos.reuniones.forEach(item => {
                    if (deletedPhotosData[item.id] && deletedPhotosData[item.id].length > 0) {
                        const deletedIndices = deletedPhotosData[item.id];
                        item.fotos = item.fotos.filter((foto, idx) => !deletedIndices.includes(idx));
                    }
                });
                datos.adicional.forEach(item => {
                    if (deletedPhotosData[item.id] && deletedPhotosData[item.id].length > 0) {
                        const deletedIndices = deletedPhotosData[item.id];
                        item.fotos = item.fotos.filter((foto, idx) => !deletedIndices.includes(idx));
                    }
                });
                
                // Calcular estad√≠sticas reales (ahora con localStorage aplicado)
                const numEmpresas = datos.reuniones.length + datos.adicional.length;
                const numReuniones = datos.reuniones.length;
                const numOportunidades = datos.adicional.length;
                
                // Contar fotos totales (despu√©s de filtrar borradas)
                let numFotos = 0;
                datos.reuniones.forEach(item => {
                    numFotos += (item.fotos || []).length;
                    numFotos += (item.fotos_extra || []).length;
                });
                datos.adicional.forEach(item => {
                    numFotos += (item.fotos || []).length;
                    numFotos += (item.fotos_extra || []).length;
                });
                
                console.log('üìä Estad√≠sticas calculadas:', {
                    empresas: numEmpresas,
                    reuniones: numReuniones,
                    fotos: numFotos,
                    oportunidades: numOportunidades
                });
                
                // Iniciar animaci√≥n de estad√≠sticas con n√∫meros reales despu√©s de 3 segundos
                setTimeout(() => {
                    animateStats(numEmpresas, numReuniones, numFotos, numOportunidades);
                }, 3000);
                
            } catch (error) {
                console.error('‚ùå Error cargando datos para splash:', error);
                // Fallback a n√∫meros por defecto si hay error
                setTimeout(() => {
                    animateStats(36, 25, 80, 11);
                }, 3000);
            }
            
            // Reproducir sonido de bienvenida
            playWelcomeSound();
            
            console.log('‚ú® Splash screen activado correctamente');
        }
        
        function generateParticles() {
            const container = document.getElementById('particlesContainer');
            const particleCount = 60;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 8 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 6) + 's';
                container.appendChild(particle);
            }
        }
        
        function animateStats(numEmpresas = 36, numReuniones = 25, numFotos = 80, numOportunidades = 11) {
            const stats = [
                { id: 'stat1', target: numEmpresas, duration: 1500 },
                { id: 'stat2', target: numReuniones, duration: 1500 },
                { id: 'stat3', target: numFotos, duration: 1500 },
                { id: 'stat4', target: numOportunidades, duration: 1500 }
            ];
            
            stats.forEach((stat, index) => {
                setTimeout(() => {
                    animateNumber(stat.id, stat.target, stat.duration);
                }, index * 400);
            });
        }
        
        function animateNumber(elementId, target, duration) {
            const element = document.getElementById(elementId);
            const start = 0;
            const increment = target / (duration / 16);
            let current = start;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                    element.classList.add('glow');
                    setTimeout(() => element.classList.remove('glow'), 500);
                }
                element.textContent = Math.floor(current);
            }, 16);
        }
        
        function playWelcomeSound() {
            // Audio de bienvenida relajante (frecuencias suaves)
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Crear secuencia de notas relajantes
                const notes = [
                    { freq: 523.25, time: 0, duration: 0.3 },    // C5
                    { freq: 659.25, time: 0.2, duration: 0.3 },  // E5
                    { freq: 783.99, time: 0.4, duration: 0.3 },  // G5
                    { freq: 1046.50, time: 0.6, duration: 0.5 }  // C6
                ];
                
                notes.forEach(note => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = note.freq;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime + note.time);
                    gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + note.time + 0.05);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + note.time + note.duration);
                    
                    oscillator.start(audioContext.currentTime + note.time);
                    oscillator.stop(audioContext.currentTime + note.time + note.duration);
                });
            } catch (error) {
                console.log('Audio not supported');
            }
        }
        
        function closeSplash() {
            console.log('üö™ Cerrando splash screen...');
            const splash = document.getElementById('splashScreen');
            splash.classList.add('fade-out');
            
            setTimeout(() => {
                splash.style.display = 'none';
                // NO guardamos en localStorage para que se muestre cada vez
                console.log('‚úÖ Splash cerrado - Se mostrar√° de nuevo en la pr√≥xima visita');
            }, 1000);
        }
        
        // Modificar el event listener para incluir splash
        window.addEventListener('DOMContentLoaded', function() {
            loadData();
            initSplashScreen();
        });
    </script>
</body>
</html>
